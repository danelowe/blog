<!DOCTYPE html>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http_equiv='X-UA-Compatible'>
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<link href='https://fonts.googleapis.com/css?family=Oxygen:300,400,700' rel='stylesheet' type='text/css'>
<link href='apple-touch-icon-152x152-precomposed.png' rel='apple-touch-icon' sizes='152x152'>
<link href='apple-touch-icon-144x144-precomposed.png' rel='apple-touch-icon' sizes='144x144'>
<link href='apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon' sizes='114x114'>
<link href='apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon' sizes='72x72'>
<link href='apple-touch-icon-precomposed.png' rel='apple-touch-icon'>
<link href='favicon.png' rel='shortcut icon'>
<link href='favicon.ico' rel='icon' type='image/ico'>
<title>Dane Lowe - A blog about Ruby, Rails and Magento</title>
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
<link href="/stylesheets/all-5c3f3084.css" rel="stylesheet" type="text/css" />
<script src="/javascripts/all-b51db3d4.js" type="text/javascript"></script>
</head>
<body class='x2015'>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-24341865-3', 'danelowe.name');
  ga('send', 'pageview');
</script>

<header>
<section class='container'>
<strong><a href="/">Dane Lowe</a></strong>
<div class='tags_list'>
<a href="/tags/magento.html">Magento</a>
<a href="/tags/ruby.html">Ruby</a>
<a href="/tags/patterns.html">Patterns</a>
<a href="/tags/sysadmin.html">Sysadmin</a>
</div>
</section>
</header>
<section class='container' id='content'><h1>
Archive for
2015
</h1>
<div class='post_list'>
<div class='post' data-href='/magento-flat-catalog-remembers-store-id.html'>
<div class='data'>
<span class='date'>14 November 2015</span>
<div class='tags_list'>
<a href="/tags/magento.html">Magento</a>
</div>
</div>
<div class='intro'>
<h2><a href="/magento-flat-catalog-remembers-store-id.html">Magento's Flat Catalog Remembers Store ID</a></h2>
<p>If you're using store emulation, and loading product collections while emulating a store,
you need to be aware of one massive gotcha.</p>

<p><strong>Magento keeps the store id for a flat collection in a <em>singleton</em></strong></p>

<p>Consider the following code: </p>

<pre class="highlight php"><code><span class="cp">&lt;?php</span> 
<span class="k">public</span> <span class="k">function</span> <span class="nf">reindexAll</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nx">Mage</span><span class="o">::</span><span class="na">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getStores</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$_store</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_reindex</span><span class="p">(</span><span class="nv">$_store</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">protected</span> <span class="k">function</span> <span class="nf">_reindex</span><span class="p">(</span><span class="nv">$storeId</span><span class="p">,</span> <span class="nv">$products</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$initialEnvironment</span> <span class="o">=</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">getSingleton</span><span class="p">(</span><span class="s1">'core/app_emulation'</span><span class="p">)</span></code></pre>
</div>
</div>
<div class='post' data-href='/how-time-fields-work-in-magento.html'>
<div class='data'>
<span class='date'>23 September 2015</span>
<div class='tags_list'>
<a href="/tags/magento.html">Magento</a>
</div>
</div>
<div class='intro'>
<h2><a href="/how-time-fields-work-in-magento.html">How Time Fields work in Magento</a></h2>
<p>Magento stores time values in the system config database table as 
comma-separated values for hours, minutes, and seconds, 
but it displays the configuration options as three dropdown boxes.</p>

<p>I've often wondered what class controlled this behaviour, 
thinking there would be some canonical way of creating config values composed of multiple HTMl fields.</p>

<p>As it turns out, this behaviour is not specific to time fields. 
<code>core/config_data</code> models just naively serialize arrays to comma-separated values...</p>
</div>
</div>
<div class='post' data-href='/simple-and-robust-nginx-config-for-magento.html'>
<div class='data'>
<span class='date'> 5 February 2015</span>
<div class='tags_list'>
<a href="/tags/magento.html">Magento</a>
<a href="/tags/sysadmin.html">Sysadmin</a>
</div>
</div>
<div class='intro'>
<h2><a href="/simple-and-robust-nginx-config-for-magento.html">Simple and Robust Nginx config for Magento</a></h2>
<p>I have a few requirements for my Magento Nginx configuration</p>

<ol>
  <li>I need to understand what it is doing, at first glance.</li>
  <li>I need to be able to create subdomains in a DRY fashion.</li>
  <li>It needs to be secure.</li>
  <li>It needs to work, and be performant.</li>
</ol>

<p>This is not using any load-balancer. It is a single server fronted by Nginx.</p>

<p>This isn't too much to ask, but the idiomatic Nginx config for Magento just wasn't cutting it for me. </p>

<p>I've always been bugged by the fact that Magento dumps application code...</p>
</div>
</div>
<div class='post' data-href='/if-business-logic-worked-like-a-business.html'>
<div class='data'>
<span class='date'>30 January 2015</span>
<div class='tags_list'>
<a href="/tags/ruby.html">Ruby</a>
<a href="/tags/patterns.html">Patterns</a>
</div>
</div>
<div class='intro'>
<h2><a href="/if-business-logic-worked-like-a-business.html">If Business Logic worked like a business</a></h2>
<p>It often seems as if half the battle with building and maintaining large web applications 
is determining where the logic should go. </p>

<p>We start off by making our controllers 'skinny'. 
This is almost a given, and makes sense when you consider them as simple 'adapters' in a 
<a href="http://victorsavkin.com/post/42542190528/hexagonal-architecture-for-rails-developers">hexagonal architecture</a>.
All the controller needs to do is make sure it can serve the request, 
and act as a mediator between the application and the user.</p>

<p>P.S. If you really want to see what hell fat controllers can cause...</p>
</div>
</div>
<div class='post' data-href='/bulk-updating-eav-attributes-in-magento.html'>
<div class='data'>
<span class='date'>22 January 2015</span>
<div class='tags_list'>
<a href="/tags/magento.html">Magento</a>
</div>
</div>
<div class='intro'>
<h2><a href="/bulk-updating-eav-attributes-in-magento.html">Bulk updating EAV attributes in Magento</a></h2>
<h2 id="dont-fear-the-eav">Don't fear the EAV</h2>
<p>EAV in Magento is a pain. It's slow and difficult to manage. But it's not going away.</p>

<p>Sometimes (well, all of the time) I wish there was a PostgreSQL adapter for Magento and it did away with EAV for one of
the many features (HSTORE, JSON field queries) Postgres has that makes EAV in Magento's case unecessary. I think that is
a project for another day.</p>

<p>Right now. There are many situations where data just needs to be stored in an EAV attribute.
Sorting, for example, is designed...</p>
</div>
</div>
</div>


</section>
<footer>
<section class='container'>
<div class='column'>
<h2>Recent Articles</h2>
<ol>
<li><a href="/magento-flat-catalog-remembers-store-id.html">Magento's Flat Catalog Remembers Store ID</a></li>
<li><a href="/how-time-fields-work-in-magento.html">How Time Fields work in Magento</a></li>
<li><a href="/simple-and-robust-nginx-config-for-magento.html">Simple and Robust Nginx config for Magento</a></li>
<li><a href="/if-business-logic-worked-like-a-business.html">If Business Logic worked like a business</a></li>
<li><a href="/bulk-updating-eav-attributes-in-magento.html">Bulk updating EAV attributes in Magento</a></li>
<li><a href="/how-to-get-an-eav-product-collection-when-flat-catalog-is-enabled.html">How to get an EAV product collection when Flat Catalog is Enabled</a></li>
</ol>
</div>
<div class='column'>
<h2>Tags</h2>
<ol>
<li><a href="/tags/magento.html">Magento (5)</a></li>
<li><a href="/tags/ruby.html">Ruby (1)</a></li>
<li><a href="/tags/patterns.html">Patterns (1)</a></li>
<li><a href="/tags/sysadmin.html">Sysadmin (1)</a></li>
</ol>
</div>
<div class='column'>
<h2>About</h2>
<p>Hi. I'm Dane, a web developer that works with Magento, Ruby and HTML/CSS/JS</p>
<p>
<span class='e'>dane</span>
</p>
</div>
</section>
</footer>
</body>
