<!DOCTYPE html>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http_equiv='X-UA-Compatible'>
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<link href='https://fonts.googleapis.com/css?family=Oxygen:300,400,700' rel='stylesheet' type='text/css'>
<link href='apple-touch-icon-152x152-precomposed.png' rel='apple-touch-icon' sizes='152x152'>
<link href='apple-touch-icon-144x144-precomposed.png' rel='apple-touch-icon' sizes='144x144'>
<link href='apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon' sizes='114x114'>
<link href='apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon' sizes='72x72'>
<link href='apple-touch-icon-precomposed.png' rel='apple-touch-icon'>
<link href='favicon.png' rel='shortcut icon'>
<link href='favicon.ico' rel='icon' type='image/ico'>
<title>If Business Logic worked like a business</title>
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
<link href="/stylesheets/all-5c3f3084.css" rel="stylesheet" type="text/css" />
<script src="/javascripts/all-b51db3d4.js" type="text/javascript"></script>
</head>
<body class='if-business-logic-worked-like-a-business'>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-24341865-3', 'danelowe.name');
  ga('send', 'pageview');
</script>

<header>
<section class='container'>
<strong><a href="/">Dane Lowe</a></strong>
<div class='tags_list'>
<a href="/tags/magento.html">Magento</a>
<a href="/tags/ruby.html">Ruby</a>
<a href="/tags/patterns.html">Patterns</a>
<a href="/tags/sysadmin.html">Sysadmin</a>
</div>
</section>
</header>
<section class='container' id='content'><div class='post'>
<div class='data'>
<span class='date'>30 January 2015</span>
<div class='tags_list'>
<a href="/tags/ruby.html">Ruby</a>
<a href="/tags/patterns.html">Patterns</a>
</div>
</div>
<div class='content'>
<h1>If Business Logic worked like a business</h1>
<p>It often seems as if half the battle with building and maintaining large web applications 
is determining where the logic should go. </p>

<p>We start off by making our controllers 'skinny'. 
This is almost a given, and makes sense when you consider them as simple 'adapters' in a 
<a href="http://victorsavkin.com/post/42542190528/hexagonal-architecture-for-rails-developers">hexagonal architecture</a>.
All the controller needs to do is make sure it can serve the request, 
and act as a mediator between the application and the user.</p>

<p>P.S. If you really want to see what hell fat controllers can cause, try doing some heavy customisation on Magento. 
You'll soon develop a really good feel for why they shouldn't be telling the others how to do their job.</p>

<p>So now we come across issues where our models are taking on a bit too much, 
and aren't quite as agile as they used to be.
There is endless debate about how to deal with fat models, <strong>and for good reason</strong>. 
It is not something that can be dealt with by one single 'rule' or 'strategy' acting as a panacea.</p>

<p>To understand the complexity, perhaps we draw a metaphor as the application as a business,
and look at how business logic is applied. 
When you consider the metaphor, there are a staggering number of similarities in how business logic affects 
complexity and agility.</p>

<h2 id="it-all-about-separation-of-concerns">It all about Separation of Concerns</h2>

<p>For a business to work well, we can't have silos, 
but each person in the business needs to know what their role is, and do that role well. 
Consider that you shouldn't have to tell your co-worker how to do their job, 
but you definitely need to know what she is doing if it affects your work. </p>

<p>There's always a balance needed, and it is very rarely met just right in practice.
There is not a single organisational structure that suits all businesses.
In fact, for most large businesses, I would not expect a single arrangement to suit every working group within it. </p>

<p>So we need a pick and mix of strategies, each with their own characteristics. </p>

<h2 id="the-callback">The callback</h2>

<p>This could be considered quite an informal arrangement that gets things done without much red tape. 
Bob has a note on his desk saying "Before you file the quote, make sure you get Sally to add the taxes". </p>

<p>This is nice and simple, but fill Bob's desk with twenty more notes and he might start complaining that he has his 
fingers in too many pies, and would rather concentrate on his own work. 
What happens when management forgets to tell Bob that Sally no longer works there, or that she's struggling with
her workload so there is a receptionist to deal with her jobs. Bob will keep doing the wrong thing. </p>

<p>Sure, tell Bob if you remember, </p>

<p>As the business grows, the callback becomes a bit of a liability.</p>

<p>Bob find's a P.S. at the bottom of the note. 
"It's probably best you give Sally the quote, and politely request that she write the full details down on it, 
we don't want a repeat of last time you just asked her for the figures and accidentally mixed up VAT with GST"</p>

<h2 id="the-listening-committee">The listening committee</h2>

<p>Bob got so frustrated, he asked for something to be done. 
The director decided to set up a group of people who just 
sit around all day waiting for people to tell them when they've reached a certain point in the tasks. 
One or more of these people might be interested that Bob is about to finish a quote, 
and organise for someone else do do something with it. </p>

<p>This came with a problem, and it wasn't that they were demanding too much money for doing nothing.
Oh no, these workers are paid by the millisecond.</p>

<p>The problems were noticed by the director. 
He had a call to say that a client never received a quote that was supposed to be emailed to them.</p>

<p>When the director approached Bob to find out what was going on, all he could say was 
"Meh, I created the quote, didn't I"</p>

<p>The communications department reported that they never received a request to send a quote. </p>

<p>Something's just not right, and the director has no visibilty over it. 
She naturally assumes the best solution to the problem is to make sure bob tells the communications department.</p>

<p>A week later, there are reports of people getting multiple quote emails. What the hell is going on? 
She remembers that pesky listening committee! </p>

<p>She asks all of them whether they have anything to do with quotes and emails.
One of them replies, "Oh yeah, I didn't think the communications department needed to worry about that quote."</p>

<p>So while the ever-opinionated Rails deprecated Observers in 4.0, 
Magento has been using them extensively and to great effect to allow customisation.</p>

<p>What is the difference? Well probably close to 8 million lines of code, and the fact that Magento is a big corporation.
Magento is also a complete platform rather than a framework.
Magento can't really deal with having each department even know about the other
if the director needs to swap out one of the departments.<br />
In fact, the Magento 'director' is so used to dealing with with the corporation as it is 
that he considers the departments to be more like agencies that the company employs, and he is constantly consulting
his listening committee as he knows they often have their hand in things 
to make sure each agency's output is what they need.</p>

<p>The director take a while to reflect then tells the listening committee 
"It's not your job to make business decisions!"</p>

<h2 id="service-objects">Service objects</h2>

<p>Well then, whose job is it to make those decisions? There are just too many for one person to handle, 
but the director needs to have visibility over the entire business if needed.</p>

<p>What we need is middle management!</p>

<p>Let's create a Manager whose job is to ensure customer's get their invoices. What a novel idea!</p>

<p>Steve is hired for the job, and we just need to make sure that Estelle knows to tell him whenever 
a customer might need an invoice. 
Steve isn't going anywhere in a hurry, and if he needs to change the process, he will handle it, end to end.</p>

<p>Bob just does what he's told, and doesn't care too much about what is outside his control. </p>

<p>The problem? Well it mostly works. We just need to hire smart Managers who know how and when to delegate.
Not too much, not too little. 
Oh, and sometimes the staff get a little bit confused when multiple people are telling them what to do. </p>

<p>Oh, and we don't want too many managers on a single level, they tend to confuse things and start conflicts.</p>

<p>Want managers who do their job well, and know their place? 
<a href="http://brewhouse.io/blog/2014/04/30/gourmet-service-objects.html">Try making their job descriptions as clear as possible.</a></p>

<h2 id="get-me-the-business-consulting-group-on-the-line">Get me the business consulting group on the line!</h2>

<p>I wonder if the metaphor could be taken a lot further, or is already stretched too far, 
or whether it is even a good way to look at an application.</p>

<p>We didn't even get into SOLID principles 
and the details on how the staff need to communicate or what their job descriptions should be.</p>

<p>The point of the whole exercise is to illustrate a large application, like a business, is not at all simple.
For each, there is no perfect recipe that always works (other than having all the experience in the world). </p>

<p>Simplicity is a good thing that we should always strive for, but realise that it is not going to come out of one thing.</p>


<div id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
                  var disqus_shortname = 'danelowe';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
//<![CDATA[
    var disqus_shortname = 'danelowe';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
//]]>
</script>

</div>
</div>
</section>
<footer>
<section class='container'>
<div class='column'>
<h2>Recent Articles</h2>
<ol>
<li><a href="/simple-and-robust-nginx-config-for-magento.html">Simple and Robust Nginx config for Magento</a></li>
<li><a href="/if-business-logic-worked-like-a-business.html">If Business Logic worked like a business</a></li>
<li><a href="/bulk-updating-eav-attributes-in-magento.html">Bulk updating EAV attributes in Magento</a></li>
<li><a href="/how-to-get-an-eav-product-collection-when-flat-catalog-is-enabled.html">How to get an EAV product collection when Flat Catalog is Enabled</a></li>
</ol>
</div>
<div class='column'>
<h2>Tags</h2>
<ol>
<li><a href="/tags/magento.html">Magento (3)</a></li>
<li><a href="/tags/ruby.html">Ruby (1)</a></li>
<li><a href="/tags/patterns.html">Patterns (1)</a></li>
<li><a href="/tags/sysadmin.html">Sysadmin (1)</a></li>
</ol>
</div>
<div class='column'>
<h2>About</h2>
<p>Hi. I'm Dane, a web developer that works with Magento, Ruby and HTML/CSS/JS</p>
<p>
<span class='e'>dane</span>
</p>
</div>
</section>
</footer>
</body>
